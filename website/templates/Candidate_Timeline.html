<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="../static/styles/style.css" />
    <title>Timeline</title>
    <link rel="stylesheet" href="../static/styles/timeline.css">
  </head>

  <body>
    <header>
      <nav>
        <ul>
          <li><a href="/">Timeline</a></li>
          <li><a href="#">Ballot</a></li>
          <li><a href="/live-results">Live Result</a></li>
          <li><a href="/settings">Settings</a></li>
        </ul>
      </nav>
    </header>
    <div class="flash-container">
        {% with messages = get_flashed_messages(with_categories=true) %} 
        {% if messages %} 
        {% for category, message in messages %} 
        {% if category == 'error' %}
        <div class="flash flash-error">
          <span>{{ message }}</span>
          <button class="flash-close-btn" type="button">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% elif category == 'success' %}
        <div class="flash flash-success">
          <span>{{ message }}</span>
          <button class="flash-close-btn" type="button">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% endif %} {% endfor %} {% endif %} {% endwith%}
    </div>

    {% if user.userType == "Admin" or isCandidate == True %}
    <div class="add-post-section">
      <form action="/" method="POST" enctype="multipart/form-data">
        <textarea name="text" id="" placeholder="Add Post to Your Timeline" oninput="autoResize(this)"></textarea>
        <div class="input-post-container">
          <div class="input-file-container">
            <span class="file-name"></span>
            <label for="post-image"><i class="post-image-icon fa-regular fa-image"></i></label>
            <input type="file" name="post-image" id="post-image" onchange="displayFileName(this)">
          </div>
          <button class="post-btn" type="submit">Post</button>
        </div>
      </form>
    </div>
    {% endif %}

    {% for post in posts %}
    <div class="timeline">
      <div class="timeline-item">
        <div class="centered-icon">
          <img src="../static/images/CSC_LOGO.png" alt="User Icon" />
          {% if post.userRole == "Admin" %}
          <p class="user-name">PUP BIÃ‘AN COMMISSION ON ELECTION</p>
          {% else %}
          <p style="margin-bottom: .5rem; line-height: 1; font-weight: bold;">{{post.userName}}</p>
          <p style="margin-top: 0; line-height: 1; font-weight: bold;">Running for {{post.userRole}}</p>
          {% endif %}
        </div>
        <p class="timeline-text" style="white-space: pre-wrap;">{{ post.text | trim }}</p>
        {% if post.imageSrc %}
        <img class="post-image" src="{{post.imageSrc}}" alt="">
        {% endif %}
        <div class="options-icon">
          <div class="options-icon">
            {% if user.userType == "Admin" or post.userId == user.userId %}
            <span class="option"><i class="fas fa-trash-alt" onclick="deletePost({{post.id}})"></i></span>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
    
    <script src="../static/scripts/index.js"></script>
    <script src="../static/scripts/timeline.js"></script>
  </body>
</html>
